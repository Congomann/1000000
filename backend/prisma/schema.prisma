generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String    @id @default(uuid()) @db.Uuid
  email               String    @unique
  passwordHash        String?   @map("password_hash")
  name                String
  role                String
  category            String    @default("Insurance & General")
  title               String?
  phone               String?
  avatar              String?
  bio                 String?
  micrositeEnabled    Boolean   @default(false) @map("microsite_enabled")
  productsSold        String[]  @map("products_sold")
  licenseStates       String[]  @map("license_states")
  onboardingCompleted Boolean   @default(false) @map("onboarding_completed")
  calendarUrl         String?   @map("calendar_url")
  socialLinks         Json?     @map("social_links")
  createdAt           DateTime  @default(now()) @map("created_at")
  deletedAt           DateTime? @map("deleted_at")

  leads           Lead[]
  clients         Client[]
  applications    Application[]
  transactions    Transaction[]
  portfolios      Portfolio[]

  @@map("users")
}

model Lead {
  id                String   @id @default(uuid()) @db.Uuid
  name              String
  email             String?
  phone             String?
  interest          String?
  status            String   @default("New")
  score             Int      @default(50)
  qualification     String?
  source            String?
  assignedTo        String?  @map("assigned_to") @db.Uuid
  message           String?
  notes             String?
  priority          String   @default("Low")
  
  lifeDetails       Json?    @map("life_details")
  realEstateDetails Json?    @map("real_estate_details")
  securitiesDetails Json?    @map("securities_details")
  customDetails     Json?    @map("custom_details")
  
  campaignId        String?  @map("campaign_id")
  adGroupId         String?  @map("ad_group_id")
  adId              String?  @map("ad_id")
  platformData      Json?    @map("platform_data")
  
  isArchived        Boolean  @default(false) @map("is_archived")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @default(now()) @updatedAt @map("updated_at")

  advisor           User?    @relation(fields: [assignedTo], references: [id])
  applications      Application[]

  @@index([email])
  @@index([assignedTo])
  @@map("leads")
}

model Client {
  id               String   @id @default(uuid()) @db.Uuid
  advisorId        String?  @map("advisor_id") @db.Uuid
  userId           String?  @map("user_id") @db.Uuid
  name             String
  email            String?
  phone            String?
  
  product          String?
  policyNumber     String?  @map("policy_number")
  carrier          String?
  premium          Decimal? @db.Decimal(12, 2)
  renewalDate      DateTime? @map("renewal_date") @db.Date
  commissionAmount Decimal? @map("commission_amount") @db.Decimal(12, 2)
  
  address          Json?
  createdAt        DateTime @default(now()) @map("created_at")

  advisor          User?    @relation(fields: [advisorId], references: [id])

  @@index([advisorId])
  @@map("clients")
}

model Application {
  id           String   @id @default(uuid()) @db.Uuid
  leadId       String?  @map("lead_id") @db.Uuid
  advisorId    String?  @map("advisor_id") @db.Uuid
  clientName   String?  @map("client_name")
  carrier      String?
  policyNumber String?  @map("policy_number")
  status       String?
  premium      Decimal? @db.Decimal(12, 2)
  createdAt    DateTime @default(now()) @map("created_at")

  lead         Lead?    @relation(fields: [leadId], references: [id])
  advisor      User?    @relation(fields: [advisorId], references: [id])

  @@map("applications")
}

model Transaction {
  id              String   @id @default(uuid()) @db.Uuid
  advisorId       String?  @map("advisor_id") @db.Uuid
  propertyAddress String?  @map("property_address")
  clientName      String?  @map("client_name")
  role            String?
  amount          Decimal? @db.Decimal(15, 2)
  status          String?
  stage           String?
  closingDate     DateTime? @map("closing_date") @db.Date
  earnestMoney    Decimal? @map("earnest_money") @db.Decimal(12, 2)
  createdAt       DateTime @default(now()) @map("created_at")

  advisor         User?    @relation(fields: [advisorId], references: [id])

  @@map("transactions")
}

model Portfolio {
  id             String   @id @default(uuid()) @db.Uuid
  advisorId      String?  @map("advisor_id") @db.Uuid
  clientName     String?  @map("client_name")
  totalValue     Decimal? @map("total_value") @db.Decimal(15, 2)
  ytdReturn      Decimal? @map("ytd_return") @db.Decimal(5, 2)
  riskProfile    String?  @map("risk_profile")
  holdings       Json?
  lastRebalanced DateTime? @map("last_rebalanced")
  createdAt      DateTime @default(now()) @map("created_at")

  advisor        User?    @relation(fields: [advisorId], references: [id])

  @@map("portfolios")
}

model IntegrationLog {
  id           String   @id @default(uuid()) @db.Uuid
  platform     String?
  eventType    String?  @map("event_type")
  status       String?
  payload      Json?
  errorMessage String?  @map("error_message")
  createdAt    DateTime @default(now()) @map("created_at")

  @@map("integration_logs")
}
